<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ATS Scoring Platform</title>
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Mammoth for DOCX parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.21/mammoth.browser.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass {
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            backdrop-filter: blur(16px) saturate(180%);
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
        .glass-dark {
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            backdrop-filter: blur(16px) saturate(180%);
            background-color: rgba(17, 25, 40, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .btn-gradient { background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); }
        .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-lift:hover { transform: translateY(-6px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); }
        .chip-matched { background: rgba(34,197,94,0.2); border: 1px solid rgba(34,197,94,0.5); }
        .chip-missing { background: rgba(239,68,68,0.2); border: 1px solid rgba(239,68,68,0.5); }
        .spinner { border: 2px solid rgba(255,255,255,0.3); border-radius:50%; border-top:2px solid #fff; width:20px; height:20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
    </style>
</head>
<body class="gradient-bg text-white min-h-screen flex items-center justify-center p-4">
    <div class="max-w-7xl w-full grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Section: Feature Card -->
        <div class="glass glass-dark rounded-2xl p-8 hover-lift">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">ATS Scoring Platform</h1>
            <p class="text-gray-300 mb-6">Elevate your job search with AI-powered resume optimization and smart keyword matching.</p>
            <div class="space-y-4 mb-8">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"><span class="text-white font-bold">✓</span></div>
                    <span>Smart Keyword Matching</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"><span class="text-white font-bold">✓</span></div>
                    <span>Resume Builder with Export</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center"><span class="text-white font-bold">✓</span></div>
                    <span>Recruiter Tools & Insights</span>
                </div>
            </div>
            <div class="flex space-x-4">
                <button id="tryDemoBtn" class="btn-gradient text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">Try Demo</button>
                <button id="whatsNewBtn" class="glass glass-dark text-white px-6 py-3 rounded-lg font-semibold hover:bg-white/10 transition-colors">What’s New</button>
            </div>
        </div>

        <!-- Right Section: Auth and Dashboard -->
        <div class="space-y-6">
            <!-- Auth Forms -->
            <div id="authSection" class="glass glass-dark rounded-2xl p-8 hover-lift">
                <div class="flex justify-center mb-6">
                    <button id="loginTab" class="px-4 py-2 rounded-l-lg bg-white/20 text-white font-semibold">Login</button>
                    <button id="registerTab" class="px-4 py-2 rounded-r-lg bg-transparent text-gray-300 font-semibold">Register</button>
                </div>

                <form id="loginForm" class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" required>
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" required>
                    <button type="submit" class="w-full btn-gradient text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">Login</button>
                </form>

                <form id="registerForm" class="space-y-4 hidden">
                    <input type="text" id="registerName" placeholder="Full Name" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" required>
                    <input type="email" id="registerEmail" placeholder="Email" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" required>
                    <input type="password" id="registerPassword" placeholder="Password" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" required>
                    <button type="submit" class="w-full btn-gradient text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity">Register</button>
                </form>

                <div class="mt-4 text-center">
                    <button id="demoLoginBtn" class="text-blue-400 hover:underline">Login as Demo User</button>
                    <!-- Visible demo credentials hint -->
                    <p class="text-xs text-gray-400 mt-2">Demo credentials: <span class="text-yellow-300">admin@ats-scoring.com / admin123</span></p>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboardSection" class="glass glass-dark rounded-2xl p-8 hover-lift hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Dashboard</h2>
                    <button id="logoutBtn" class="text-red-400 hover:underline">Logout</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="glass glass-dark p-4 rounded-lg text-center hover-lift cursor-pointer" onclick="openScanner()">
                        <h3 class="font-semibold mb-2">Check ATS Score</h3>
                        <p class="text-sm text-gray-300">Upload resume & job desc</p>
                    </div>
                    <div class="glass glass-dark p-4 rounded-lg text-center hover-lift cursor-pointer" onclick="buildResume()">
                        <h3 class="font-semibold mb-2">Build Resume</h3>
                        <p class="text-sm text-gray-300">Create & export</p>
                    </div>
                    <div class="glass glass-dark p-4 rounded-lg text-center hover-lift cursor-pointer" onclick="browseJobs()">
                        <h3 class="font-semibold mb-2">Browse Jobs</h3>
                        <p class="text-sm text-gray-300">Find opportunities</p>
                    </div>
                </div>

                <!-- Scanner Modal -->
                <div id="scannerModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
                    <div class="glass glass-dark rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-xl font-bold mb-4">ATS Scanner</h3>
                        <input type="file" id="resumeFile" accept=".pdf,.docx,.txt" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 mb-4">
                        <textarea id="jobDesc" placeholder="Paste job description here..." class="w-full p-3 rounded-lg bg-white/10 border border-white/20 mb-4 h-32 resize-none"></textarea>
                        <button id="scanBtn" class="w-full btn-gradient text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity flex items-center justify-center">
                            <span id="scanText">Scan Resume</span>
                            <div id="scanSpinner" class="spinner ml-2 hidden"></div>
                        </button>
                        <div id="scanResults" class="mt-4 hidden">
                            <p class="mb-2">Match Score: <span id="matchScore" class="font-bold text-green-400"></span>%</p>
                            <div id="keywordChips" class="flex flex-wrap gap-2"></div>
                        </div>
                        <button onclick="closeScanner()" class="mt-4 text-gray-400 hover:underline">Close</button>
                    </div>
                </div>

                <!-- Resume Builder Modal -->
                <div id="resumeModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
                    <div class="glass glass-dark rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-xl font-bold mb-4">Resume Builder</h3>
                        <textarea id="resumeContent" placeholder="Enter resume content..." class="w-full p-3 rounded-lg bg-white/10 border border-white/20 mb-4 h-64 resize-none"></textarea>
                        <button onclick="exportResume('pdf')" class="w-full btn-gradient text-white py-3 rounded-lg font-semibold hover:opacity-90 transition-opacity mb-2">Export as PDF</button>
                        <button onclick="exportResume('txt')" class="w-full glass glass-dark text-white py-3 rounded-lg font-semibold hover:bg-white/10 transition-colors">Export as TXT</button>
                        <button onclick="closeResume()" class="mt-4 text-gray-400 hover:underline">Close</button>
                    </div>
                </div>

                <!-- Jobs Modal -->
                <div id="jobsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden">
                    <div class="glass glass-dark rounded-2xl p-8 max-w-md w-full mx-4">
                        <h3 class="text-xl font-bold mb-4">Browse Jobs</h3>
                        <div class="space-y-4">
                            <div class="glass glass-dark p-4 rounded-lg">
                                <h4 class="font-semibold">Software Engineer</h4>
                                <p class="text-sm text-gray-300">Tech Corp - Remote</p>
                            </div>
                            <div class="glass glass-dark p-4 rounded-lg">
                                <h4 class="font-semibold">Data Analyst</h4>
                                <p class="text-sm text-gray-300">Data Inc - On-site</p>
                            </div>
                            <div class="glass glass-dark p-4 rounded-lg">
                                <h4 class="font-semibold">Product Manager</h4>
                                <p class="text-sm text-gray-300">Startup XYZ - Hybrid</p>
                            </div>
                        </div>
                        <button onclick="closeJobs()" class="mt-4 text-gray-400 hover:underline">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="fixed bottom-4 right-4 glass glass-dark rounded-lg p-4 hidden">
        <p id="toastMessage"></p>
    </div>

    <script>
        // ---------- Global state ----------
        let isLoggedIn = false;
        let user = null;

        // ---------- DOM elements ----------
        const authSection = document.getElementById('authSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const demoLoginBtn = document.getElementById('demoLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const scannerModal = document.getElementById('scannerModal');
        const resumeModal = document.getElementById('resumeModal');
        const jobsModal = document.getElementById('jobsModal');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // ---------- Tab switching ----------
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('bg-white/20');
            loginTab.classList.remove('bg-transparent', 'text-gray-300');
            registerTab.classList.remove('bg-white/20');
            registerTab.classList.add('bg-transparent', 'text-gray-300');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('bg-white/20');
            registerTab.classList.remove('bg-transparent', 'text-gray-300');
            loginTab.classList.remove('bg-white/20');
            loginTab.classList.add('bg-transparent', 'text-gray-300');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });

        // API base URL - change this to your backend URL
        const API_BASE = (window.__API_BASE_URL || 'http://localhost:5000') + '/api';

        // ---------- Session restore ----------
        window.addEventListener('load', () => {
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('user');
            if (token && userData) {
                try {
                    user = JSON.parse(userData);
                    isLoggedIn = true;
                    showDashboard();
                } catch (error) {
                    console.error('Error parsing stored user data:', error);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                }
            }
        });

        // ---------- Login ----------
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) { showToast('Please fill all fields.'); return; }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    isLoggedIn = true; user = data.user;
                    showToast('Login successful!');
                    showDashboard();
                } else {
                    showToast(data.message || 'Login failed');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('Network error. Please try again.');
            }
        });

        // ---------- Register ----------
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            if (!name || !email || !password) { showToast('Please fill all fields.'); return; }
            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, role: 'student' }),
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    isLoggedIn = true; user = data.user;
                    showToast('Account created and logged in!');
                    showDashboard();
                } else {
                    showToast(data.message || 'Registration failed');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showToast('Network error. Please try again.');
            }
        });

        // ---------- Demo login (tries backend then falls back to local demo) ----------
        demoLoginBtn.addEventListener('click', async () => {
            const demoCredentials = { email: 'admin@ats-scoring.com', password: 'admin123' };

            // 1) Try real backend login first
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(demoCredentials),
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    isLoggedIn = true; user = data.user;
                    showToast('Logged in as demo user (backend).');
                    showDashboard();
                    return;
                } else {
                    // backend responded but not OK -> log and continue to fallback
                    const text = await response.text().catch(() => 'no-body');
                    console.warn('Backend demo login failed (non-OK). Response:', text);
                }
            } catch (err) {
                console.warn('Backend unreachable for demo login, falling back to client demo:', err);
            }

            // 2) Client-side fallback (local demo session)
            const fakeToken = 'demo-token-' + Math.random().toString(36).slice(2);
            const demoUser = {
                id: 'demo-user',
                name: 'Demo Admin',
                email: demoCredentials.email,
                role: 'admin',
                demo: true
            };
            localStorage.setItem('token', fakeToken);
            localStorage.setItem('user', JSON.stringify(demoUser));
            isLoggedIn = true; user = demoUser;
            showToast('Logged in as demo user (local).');
            showDashboard();
        });

        // ---------- Logout ----------
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            isLoggedIn = false; user = null;
            showToast('Logged out successfully.');
            showAuth();
        });

        // ---------- UI helpers ----------
        function showDashboard() {
            authSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
        }
        function showAuth() {
            dashboardSection.classList.add('hidden');
            authSection.classList.remove('hidden');
        }

        // ---------- Modal open/close helpers ----------
        function openScanner() { scannerModal.classList.remove('hidden'); }
        function closeScanner() { scannerModal.classList.add('hidden'); document.getElementById('scanResults').classList.add('hidden'); }
        function buildResume() { resumeModal.classList.remove('hidden'); }
        function closeResume() { resumeModal.classList.add('hidden'); }
        function browseJobs() { jobsModal.classList.remove('hidden'); }
        function closeJobs() { jobsModal.classList.add('hidden'); }

        // ---------- Scanner logic ----------
        document.getElementById('scanBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('resumeFile');
            const jobDesc = document.getElementById('jobDesc').value;
            if (!fileInput.files[0] || !jobDesc) { showToast('Please upload a resume and enter job description.'); return; }

            document.getElementById('scanText').classList.add('hidden');
            document.getElementById('scanSpinner').classList.remove('hidden');

            try {
                const resumeText = await parseFile(fileInput.files[0]);
                const keywords = extractKeywords(jobDesc);
                const matched = keywords.filter(k => resumeText.toLowerCase().includes(k.toLowerCase()));
                const score = Math.round((matched.length / (keywords.length || 1)) * 100);

                document.getElementById('matchScore').textContent = score;
                const chipsContainer = document.getElementById('keywordChips');
                chipsContainer.innerHTML = '';
                keywords.forEach(k => {
                    const chip = document.createElement('span');
                    chip.className = `px-2 py-1 rounded-full text-sm ${matched.includes(k) ? 'chip-matched text-green-400' : 'chip-missing text-red-400'}`;
                    chip.textContent = k;
                    chipsContainer.appendChild(chip);
                });

                document.getElementById('scanResults').classList.remove('hidden');
                showToast(`Scan complete! Match score: ${score}%`);
            } catch (error) {
                console.error(error);
                showToast('Error parsing file. Please try again.');
            } finally {
                document.getElementById('scanText').classList.remove('hidden');
                document.getElementById('scanSpinner').classList.add('hidden');
            }
        });

        // ---------- File parsing ----------
        async function parseFile(file) {
            const fileType = file.name.split('.').pop().toLowerCase();
            if (fileType === 'pdf') {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ');
                }
                return text;
            } else if (fileType === 'docx') {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                return result.value;
            } else if (fileType === 'txt') {
                return await file.text();
            } else {
                throw new Error('Unsupported file type');
            }
        }

        // ---------- Simple keyword extractor ----------
        function extractKeywords(text) {
            // Remove punctuation, split, filter short words, dedupe and limit
            const words = text.replace(/[^\w\s]/g, ' ').toLowerCase().split(/\s+/).filter(Boolean);
            const filtered = words.filter(w => w.length > 2);
            // dedupe preserving order
            const seen = new Set();
            const dedup = [];
            for (const w of filtered) {
                if (!seen.has(w)) { seen.add(w); dedup.push(w); }
                if (dedup.length >= 20) break;
            }
            return dedup;
        }

        // ---------- Export resume ----------
        function exportResume(format) {
            const content = document.getElementById('resumeContent').value;
            if (!content) { showToast('Please enter resume content.'); return; }
            if (format === 'pdf') {
                // Basic blob-based PDF placeholder — for production use jsPDF or server render
                const blob = new Blob([content], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resume.pdf';
                a.click();
                URL.revokeObjectURL(url);
                showToast('Resume exported as PDF.');
            } else if (format === 'txt') {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'resume.txt';
                a.click();
                URL.revokeObjectURL(url);
                showToast('Resume exported as TXT.');
            }
        }

        // ---------- Toast ----------
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Initialize UI state
        showAuth();
    </script>
</body>
</html>